<form name="discoveryViewForms.create" ng-submit="createDiscoveryView()" novalidate class="solr-source-forms-create">
  <div class="modal-header {{attr.modalHeaderClass}}">
    <button type="button" class="close modal-close" aria-label="Close" ng-click="cancelCreateDiscoveryView()"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Create Discovery View</h4>
  </div>
  <div class="modal-body" ng-if="discoveryView">
    <alerts seconds="30" channels="source/solr/fields" types="WARNING,ERROR" exclusive></alerts>
    <validationmessage results="discoveryViewForms.getResults()"></validationmessage>

    <uib-tabset active="active.tab" justified="true">
      <uib-tab index="0" heading="General">
        <div class="row">
          <div class="col-sm-10 col-sm-offset-1">
            <br>
            <validatedinput
              id="createName"
              model="discoveryView"
              property="name"
              label="Name"
              placeholder="Name for the new Discovery View"
              form="discoveryViewForms.create"
              validations="discoveryViewForms.validations"
              results="discoveryViewForms.getResults()"
              autocomplete="off">
            </validatedinput>

            <validatedselect
              id="createSource"
              model="discoveryView"
              property="source"
              options="sources"
              optionproperty="name"
              label="Source"
              placeholder="Source for the new Writer"
              form="discoveryViewForms.create"
              validations="discoveryViewForms.validations"
              results="discoveryViewForms.getResults()"
              autocomplete="off"
              change="getFields(discoveryView)">
            </validatedselect>

            <validatedinput
              id="createFilter"
              model="discoveryView"
              property="filter"
              label="Filter"
              placeholder=""
              form="discoveryViewForms.create"
              validations="discoveryViewForms.validations"
              results="discoveryViewForms.getResults()"
              autocomplete="off">
            </validatedinput>

            <validatedinput
              id="createSlug"
              model="discoveryView"
              property="slug"
              label="Slug"
              placeholder="The URI slug of this Discovery View"
              form="discoveryViewForms.create"
              validations="discoveryViewForms.validations"
              results="discoveryViewForms.getResults()"
              autocomplete="off">
            </validatedinput>

            <validatedinput
              id="createInfoLinkText"
              model="discoveryView"
              property="infoLinkText"
              label="Info Link Text"
              placeholder="e.g. 'About This Collection'"
              form="discoveryViewForms.create"
              validations="discoveryViewForms.validations"
              results="discoveryViewForms.getResults()"
              autocomplete="off">
            </validatedinput>

            <validatedinput
              id="createInfoLinkUrl"
              model="discoveryView"
              property="infoLinkUrl"
              label="Info Link Url"
              placeholder="The URL of the info link"
              form="discoveryViewForms.create"
              validations="discoveryViewForms.validations"
              results="discoveryViewForms.getResults()"
              autocomplete="off">
            </validatedinput>

            <validatedtextarea
              property="idInfoText"
              model="discoveryView"
              property="infoText"
              label="Info Text"
              form="discoveryViewForms.create"
              validations="discoveryViewForms.validations"
              results="discoveryViewForms.getResults()">
            </validatedtextarea>

          </div>
        </div>
      </uib-tab>
      <uib-tab index="1" heading="Facets" disable="true">
        <div class="row">
          <div class="row">
            <div class="col-sm-offset-1 co-xs-12">
              <h4>Facet Fields</h4>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-2 col-sm-offset-1">
              <div class="form-group">
                <label for="key">Key</label>
                <select name="key" class="form-control" ng-model="discoveryView.facetFields[0].key" ng-options="option['name'] as option['name'] for option in fields"></select>
              </div>
            </div>
            <div class="col-xs-5">
              <div class="form-group">
                <label for="name">Label</label>
                <input name="name" placeholder="Display name of filter" type="text" class="form-control" ng-model="discoveryView.facetFields[0].label">
              </div>
            </div>
            <div class="col-xs-2">
              <div class="form-group">
                <label for="key">Widget</label>
                <select name="key" class="form-control" ng-model="discoveryView.facetFields[0].widget">
                  <option>Link</option>
                  <option>Typeahead</option>
                </select>
              </div>
            </div>
            <div class="col-xs-2">
              <div class="form-group add-field-group">
                <button type="button" class="btn btn-success" ng-click="appendFacetFieldItem(discoveryView)"><span class="glyphicon glyphicon-plus"></span></button>
              </div>
            </div>
          </div>
          <div class="row" ng-repeat="facetField in discoveryView.facetFields track by $index" ng-hide="$first">
            <div class="col-xs-2 col-sm-offset-1">
              <div class="form-group">
                <label for="key">Key</label>
                <select name="key" class="form-control" ng-model="discoveryView.facetFields[$index].key" ng-options="option['name'] as option['name'] for option in fields" ></select>
              </div>
            </div>
            <div class="col-xs-5">
              <div class="form-group">
                <label for="label">Label</label>
                <input name="label" placeholder="Display label of filter" type="text" class="form-control" ng-model="discoveryView.facetFields[$index].label">
              </div>
            </div>
            <div class="col-xs-2">
              <div class="form-group">
                <label for="widget">Widget</label>
                <select name="widget" class="form-control" ng-model="discoveryView.facetFields[$index].widget">
                  <option>Link</option>
                  <option>Typeahead</option>
                </select>
              </div>
            </div>
            <div class="col-xs-2">
              <div class="form-group add-field-group">
                  <button type="button" class="btn btn-danger" ng-click="discoveryView.facetFields.splice($index,1)"><span class="glyphicon glyphicon-minus"></span></button>
              </div>
            </div>
          </div>
        </div>
      </uib-tab>
      <uib-tab index="2" heading="Search" disable="true">
        <div class="row">
          <div class="row">
            <div class="col-sm-offset-1 co-xs-12">
              <h4>Search Fields</h4>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-2 col-sm-offset-1">
              <div class="form-group">
                <label for="key">Key</label>
                <select name="key" class="form-control" ng-model="discoveryView.searchFields[0].key" ng-options="option['name'] as option['name'] for option in fields"></select>
              </div>
            </div>
            <div class="col-xs-7">
              <div class="form-group">
                <label for="name">Label</label>
                <input name="name" placeholder="Display name of search" type="text" class="form-control" ng-model="discoveryView.searchFields[0].label">
              </div>
            </div>
            <div class="col-xs-2">
              <div class="form-group add-field-group">
                <button type="button" class="btn btn-success" ng-click="appendSearchFieldItem(discoveryView)"><span class="glyphicon glyphicon-plus"></span></button>
              </div>
            </div>
          </div>
          <div class="row" ng-repeat="searchField in discoveryView.searchFields track by $index" ng-hide="$first">
            <div class="col-xs-2 col-sm-offset-1">
              <div class="form-group">
                <label for="key">Key</label>
                <select name="key" class="form-control" ng-model="discoveryView.searchFields[$index].key" ng-options="option['name'] as option['name'] for option in fields" ></select>
              </div>
            </div>
            <div class="col-xs-7">
              <div class="form-group">
                <label for="label">Label</label>
                <input name="label" placeholder="Display label of search" type="text" class="form-control" ng-model="discoveryView.searchFields[$index].label">
              </div>
            </div>
            <div class="col-xs-2">
              <div class="form-group add-field-group">
                  <button type="button" class="btn btn-danger" ng-click="discoveryView.searchFields.splice($index,1)"><span class="glyphicon glyphicon-minus"></span></button>
              </div>
            </div>
          </div>
        </div>
      </uib-tab>
      <uib-tab index="3" heading="Results" disable="true">
        <div class="row">

          <div class="row">
            <div class="col-sm-offset-1 co-xs-12">
                <h4>Result Heading</h4>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-5 col-sm-offset-1">
              <validatedselect
                id="createUniqueIdentifierKey"
                model="discoveryView"
                property="uniqueIdentifierKey"
                options="fields"
                optionproperty="name"
                optionvalue="name"
                label="Unique Identifier Key"
                placeholder="A unique identifier key for the new Discovery View"
                form="discoveryViewForms.create"
                validations="discoveryViewForms.validations"
                results="discoveryViewForms.getResults()">
              </validatedselect>
            </div>
            <div class="col-sm-5">
              <multi-suggestion-input
                id="createTitleKey"
                model="discoveryView"
                property="titleKey"
                optionproperty="name"
                suggestions="fields"
                name="titleKey"
                label="Title Key"
                placeholder="'{{' to see Title Key suggesions">
              </multi-suggestion-input>
            </div>
          </div>
          <div class="row">
              <div class="col-sm-5 col-sm-offset-1">
                <multi-suggestion-input
                  id="createResourceThumbnailUriKey"
                  model="discoveryView"
                  property="resourceThumbnailUriKey"
                  optionproperty="name"
                  suggestions="fields"
                  name="resourceThumbnailUriKey"
                  label="Thumbnail Uri Key"
                  placeholder="'{{' to see Thumbnail Uri Key suggesions">
                </multi-suggestion-input>
              </div>
              <div class="col-sm-5">
                <multi-suggestion-input
                  id="createDiscoveryViewToCreate"
                  model="discoveryView"
                  property="resourceLocationUriKey"
                  optionproperty="name"
                  suggestions="fields"
                  name="resourceUriKey"
                  label="Resource Key"
                  placeholder="'{{' to see Resource Key suggesions">
                </multi-suggestion-input>
              </div>
            </div>
        </div>
        <hr>
        <div class="row">
          <div class="row">
            <div class="col-sm-offset-1 co-xs-12">
              <h4>Result Metadata</h4>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-3 col-sm-offset-1" ng-init="discoveryView.resultMetadataFields[0]={searchable:true,sortable:true,inList:true,inGrid:true,inSingleResult:true}">
              <div class="form-group">
                <label for="key">Key</label>
                <select name="key" class="form-control" ng-model="discoveryView.resultMetadataFields[0].key" ng-options="option['name'] as option['name'] for option in fields" ng-change="discoveryView.resultMetadataFields[0].sortable=!findFieldByKey(discoveryView.resultMetadataFields[0].key).multivalued"></select>
              </div>
            </div>
            <div class="col-xs-2">
              <div class="form-group">
                <label for="label">Label</label>
                <input name="label" placeholder="Display label of filter" type="text" class="form-control" ng-model="discoveryView.resultMetadataFields[0].label">
              </div>
            </div>
            <div class="col-xs-1">
              <div class="form-group">
                <label for="sortable">Sortable</label>
                <input name="sortable" type="checkbox" class="form-control" ng-model="discoveryView.resultMetadataFields[0].sortable" ng-disabled="findFieldByKey(discoveryView.resultMetadataFields[0].key).multivalued">
              </div>
            </div>
            <div class="col-xs-1">
              <div class="form-group">
                <label for="list">List</label>
                <input name="list" type="checkbox" class="form-control" ng-model="discoveryView.resultMetadataFields[0].inList">
              </div>
            </div>
            <div class="col-xs-1">
              <div class="form-group">
                <label for="grid">Grid</label>
                <input name="grid" type="checkbox" class="form-control" ng-model="discoveryView.resultMetadataFields[0].inGrid">
              </div>
            </div>
            <div class="col-xs-1">
              <div class="form-group">
                <label for="item">Item</label>
                <input name="item" type="checkbox" class="form-control" ng-model="discoveryView.resultMetadataFields[0].inSingleResult">
              </div>
            </div>
            <div class="col-xs-2">
              <div class="form-group add-field-group">
                <button type="button" class="btn btn-success" ng-click="discoveryView.resultMetadataFields.push({searchable:true,sortable:true,inList:true,inGrid:true,inSingleResult:true})"><span class="glyphicon glyphicon-plus"></span></button>
              </div>
            </div>
          </div>
          <div class="row" ng-repeat="resultMetadataField in discoveryView.resultMetadataFields track by $index" ng-hide="$first">
            <div class="col-xs-3 col-sm-offset-1">
              <div class="form-group">
                <label for="key">Key</label>
                <select name="key" class="form-control" ng-model="discoveryView.resultMetadataFields[$index].key" ng-options="option['name'] as option['name'] for option in fields" ng-change="discoveryView.resultMetadataFields[$index].sortable=!findFieldByKey(discoveryView.resultMetadataFields[$index].key).multivalued"></select>
              </div>
            </div>
            <div class="col-xs-2">
              <div class="form-group">
                <label for="label">Label</label>
                <input name="label" placeholder="Display label of filter" type="text" class="form-control" ng-model="discoveryView.resultMetadataFields[$index].label">
              </div>
            </div>
            <div class="col-xs-1">
              <div class="form-group">
                <label for="sortable">Sortable</label>
                <input name="sortable" type="checkbox" class="form-control" ng-model="discoveryView.resultMetadataFields[$index].sortable" ng-disabled="findFieldByKey(discoveryView.resultMetadataFields[$index].key).multivalued">
              </div>
            </div>
            <div class="col-xs-1">
              <div class="form-group">
                <label for="list">List</label>
                <input name="list" type="checkbox" class="form-control" ng-model="discoveryView.resultMetadataFields[$index].inList">
              </div>
            </div>
            <div class="col-xs-1">
              <div class="form-group">
                <label for="grid">Grid</label>
                <input name="grid" type="checkbox" class="form-control" ng-model="discoveryView.resultMetadataFields[$index].inGrid">
              </div>
            </div>
            <div class="col-xs-1">
              <div class="form-group">
                <label for="item">Item</label>
                <input name="item" type="checkbox" class="form-control" ng-model="discoveryView.resultMetadataFields[$index].inSingleResult">
              </div>
            </div>
            <div class="col-xs-2">
              <div class="form-group add-field-group">
                  <button type="button" class="btn btn-danger" ng-click="discoveryView.resultMetadataFields.splice($index,1)"><span class="glyphicon glyphicon-minus"></span></button>
              </div>
            </div>
          </div>
        </div>
      </uib-tab>
    </uib-tabset>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-default" ng-click="cancelCreateDiscoveryView()">Cancel</button>
    <button ng-show="active.tab === 0" ng-disabled="isDiscoveryViewGeneralInvalid('create')" type="button" class="btn btn-success" ng-click="next()">Next</button>
    <button ng-show="active.tab === 1" type="button" class="btn btn-success" ng-click="back()">Back</button>
    <button ng-show="active.tab === 1" ng-disabled="isDiscoveryViewResultsInvalid('create')" type="button" class="btn btn-success" ng-click="next()">Next</button>
    <button ng-show="active.tab === 2" type="button" class="btn btn-success" ng-click="back()">Back</button>
    <button ng-show="active.tab === 2" ng-disabled="isDiscoveryViewFacetsInvalid('create')" type="button" class="btn btn-success" ng-click="next()">Next</button>
    <button ng-show="active.tab === 3" type="button" class="btn btn-success" ng-click="back()">Back</button>
    <button ng-show="active.tab === 3" ng-disabled="isDiscoveryViewSearchInvalid('create') || discoveryViewForms.create.$invalid" type="submit" class="btn btn-success">Create</button>
  </div>
</form>
